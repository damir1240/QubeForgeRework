# Feature Toggles Configuration

## Обзор

Система переключателей функций (Feature Toggles) позволяет включать и отключать различные функции игры через простой конфигурационный файл. Это полезно для разработки, отладки и настройки игры под разные сценарии использования.

## Конфигурационный файл

### Расположение

Файл конфигурации находится по пути: `public/config.txt`

### Формат

Файл использует простой формат `ключ=значение`, по одной настройке на строку:

```
# Комментарий
ключ=on   # Включить функцию
ключ=off  # Выключить функцию
```

### Правила синтаксиса

- **Одна настройка на строку** в формате `ключ=значение`
- **Значения**: только `on` (включено) или `off` (выключено)
- **Комментарии**: строки, начинающиеся с `#`, игнорируются
- **Пустые строки**: игнорируются
- **Пробелы**: пробелы вокруг `=` автоматически удаляются
- **Невалидные значения**: любое значение кроме `on`/`off` считается как `off`

## Доступные переключатели

### 1. show_fps

**Описание**: Показывать счётчик FPS и статистику рендеринга

**Значение по умолчанию**: 
- `on` в режиме разработки (dev mode)
- `off` в продакшене

**Пример**:
```
show_fps=on
```

**Что контролирует**:
- Отображение окна с FPS и статистикой рендеринга в правом верхнем углу
- Полезно для отладки производительности

---

### 2. show_mods

**Описание**: Показывать кнопку "Моды" в главном меню

**Значение по умолчанию**: `on`

**Пример**:
```
show_mods=on
```

**Что контролирует**:
- Видимость кнопки "Моды" в главном меню
- Доступ к менеджеру модов
- Полезно отключить для конечных пользователей, если моды не используются

---

### 3. show_cli

**Описание**: Включить командную строку (CLI)

**Значение по умолчанию**: `on`

**Пример**:
```
show_cli=on
```

**Что контролирует**:
- Возможность открыть CLI клавишей `/` или `T`
- Доступ к отладочным командам
- Видимость интерфейса командной строки

---

### 4. enable_day_night_keys

**Описание**: Включить клавиши переключения дня/ночи

**Значение по умолчанию**: 
- `on` в режиме разработки (dev mode)
- `off` в продакшене

**Пример**:
```
enable_day_night_keys=on
```

**Что контролирует**:
- Клавиша `K` - установить ночь
- Клавиша `L` - установить день
- Полезно для тестирования освещения и времени суток

## Примеры конфигурации

### Конфигурация для разработки

Все функции включены для максимального удобства отладки:

```
# Feature Toggles Configuration
show_fps=on
show_mods=on
show_cli=on
enable_day_night_keys=on
```

### Конфигурация для продакшена

Отладочные функции отключены:

```
# Feature Toggles Configuration
show_fps=off
show_mods=on
show_cli=off
enable_day_night_keys=off
```

### Минималистичная конфигурация

Только базовая функциональность:

```
# Feature Toggles Configuration
show_fps=off
show_mods=off
show_cli=off
enable_day_night_keys=off
```

## Применение изменений

1. Отредактируйте файл `public/config.txt`
2. Сохраните изменения
3. **Обновите страницу в браузере** (F5 или Ctrl+R)

Изменения применяются только при загрузке игры, горячая перезагрузка не поддерживается.

## Обработка ошибок

### Отсутствующий файл

Если файл `config.txt` не найден:
- Используются значения по умолчанию
- В консоли появится предупреждение: `"Feature toggles config not found, using defaults"`
- Игра продолжит работу нормально

### Невалидные значения

Если указано значение отличное от `on` или `off`:
- Значение будет интерпретировано как `off`
- В консоли появится предупреждение: `"Invalid toggle value for {ключ}: {значение}, using 'off'"`

### Неправильный формат

Строки без символа `=` или с пустым ключом игнорируются без ошибок.

## Техническая информация

### Архитектура

Система использует паттерн Singleton для управления конфигурацией:

```typescript
const toggles = FeatureToggles.getInstance();
await toggles.load();  // Загрузка конфигурации

if (toggles.isEnabled('show_fps')) {
  // Создать FPS дисплей
}
```

### Порядок инициализации

1. Создание экземпляра `FeatureToggles`
2. Загрузка `config.txt` через `fetch` API
3. Парсинг конфигурации
4. Инициализация компонентов игры с учётом настроек

### Добавление новых переключателей

Для добавления нового переключателя:

1. Добавьте ключ в `FeatureToggleConfig` интерфейс
2. Добавьте значение по умолчанию в `DEFAULT_CONFIG`
3. Используйте `toggles.isEnabled('новый_ключ')` в коде
4. Добавьте ключ в `config.txt`
5. Обновите эту документацию

## Отладка

### Просмотр текущей конфигурации

Откройте консоль браузера (F12) и выполните:

```javascript
FeatureToggles.getInstance().getAll()
```

Это вернёт объект со всеми текущими значениями переключателей.

### Проверка загрузки

При загрузке игры проверьте консоль на наличие предупреждений:
- `"Feature toggles config not found, using defaults"` - файл не найден
- `"Invalid toggle value for..."` - невалидное значение в конфиге

## Часто задаваемые вопросы

**Q: Можно ли изменить настройки без перезагрузки страницы?**  
A: Нет, изменения применяются только при загрузке игры. Требуется обновить страницу.

**Q: Что если я удалю config.txt?**  
A: Игра будет использовать значения по умолчанию. В dev режиме большинство функций будут включены.

**Q: Можно ли использовать другие значения кроме on/off?**  
A: Нет, только `on` и `off`. Любые другие значения будут интерпретированы как `off`.

**Q: Где хранится config.txt в production сборке?**  
A: Файл копируется в корень `dist` папки при сборке, так как находится в `public` директории.

**Q: Можно ли иметь разные конфиги для разных пользователей?**  
A: В текущей версии нет. Конфиг общий для всех. Для персональных настроек можно использовать localStorage.
